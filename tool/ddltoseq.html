<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MySQL DDL è½¬ Sequelize å·¥å…·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .main-content {
            padding: 40px;
        }
        
        .input-section, .output-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .output-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }
        
        .tab:hover {
            color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .output-area {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            min-height: 300px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .output-container {
            position: relative;
        }
        
        .example-ddl {
            background: #f0f8ff;
            border: 1px solid #b0c4de;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        .feature-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .feature-list h3 {
            color: #667eea;
            margin-top: 0;
        }
        
        .feature-list ul {
            padding-left: 20px;
        }
        
        .feature-list li {
            margin: 8px 0;
            color: #555;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MySQL DDL è½¬ Sequelize</h1>
            <p>ä¸€é”®å°† MySQL DDL è¯­å¥è½¬æ¢ä¸ºå®Œæ•´çš„ Sequelize æ¨¡å‹ä»£ç </p>
        </div>
        
        <div class="main-content">
            <div class="feature-list">
                <h3>ğŸš€ åŠŸèƒ½ç‰¹æ€§</h3>
                <ul>
                    <li>ğŸ“Š è‡ªåŠ¨è§£æ MySQL DDL è¯­å¥</li>
                    <li>ğŸ—ï¸ ç”Ÿæˆ Sequelize æ¨¡å‹å®šä¹‰</li>
                    <li>ğŸ”„ ç”Ÿæˆæ•°æ®åº“è¿ç§»æ–‡ä»¶</li>
                    <li>ğŸŒ± ç”Ÿæˆç§å­æ•°æ®æ–‡ä»¶</li>
                    <li>ğŸ”§ æ”¯æŒå¸¸è§æ•°æ®ç±»å‹æ˜ å°„</li>
                    <li>ğŸ”— å¤„ç†å¤–é”®å…³ç³»</li>
                    <li>ğŸ“‹ ä¸€é”®å¤åˆ¶ç”Ÿæˆçš„ä»£ç </li>
                </ul>
            </div>
            
            <div class="input-section">
                <h2 class="section-title">ğŸ“ è¾“å…¥ MySQL DDL</h2>
                <div class="example-ddl">
                    <strong>ç¤ºä¾‹ DDLï¼š</strong><br>
                    CREATE TABLE users (<br>
                    &nbsp;&nbsp;id INT AUTO_INCREMENT PRIMARY KEY,<br>
                    &nbsp;&nbsp;username VARCHAR(50) NOT NULL UNIQUE,<br>
                    &nbsp;&nbsp;email VARCHAR(100) NOT NULL,<br>
                    &nbsp;&nbsp;password VARCHAR(255) NOT NULL,<br>
                    &nbsp;&nbsp;created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,<br>
                    &nbsp;&nbsp;updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP<br>
                    );
                </div>
                <textarea id="ddlInput" placeholder="åœ¨è¿™é‡Œè¾“å…¥æ‚¨çš„ MySQL DDL è¯­å¥...

-- ç¤ºä¾‹ 1: åŸºæœ¬ç”¨æˆ·è¡¨
CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(50) NOT NULL UNIQUE,
  email VARCHAR(100) NOT NULL,
  password VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- ç¤ºä¾‹ 2: å¸¦å¤–é”®çš„æ–‡ç« è¡¨
CREATE TABLE posts (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  title VARCHAR(200) NOT NULL,
  content TEXT,
  status ENUM('draft', 'published', 'archived') DEFAULT 'draft',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- æ”¯æŒçš„æ ¼å¼ï¼š
-- âœ… CREATE TABLE table_name (...)
-- âœ… CREATE TABLE IF NOT EXISTS table_name (...)
-- âœ… CREATE TABLE `table_name` (...)
-- âœ… åå¼•å·åŒ…å›´çš„å­—æ®µå
-- âœ… ENGINE=InnoDB, CHARSET=utf8mb4 ç­‰é€‰é¡¹"></textarea>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="convertDDL()">ğŸ”„ è½¬æ¢ä¸º Sequelize</button>
                <button class="btn" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>
            
            <div class="output-section">
                <h2 class="section-title">ğŸ“¤ ç”Ÿæˆçš„ Sequelize ä»£ç </h2>
                
                <div class="output-tabs">
                    <button class="tab active" onclick="showTab('models')">ğŸ“„ æ¨¡å‹æ–‡ä»¶</button>
                    <button class="tab" onclick="showTab('migration')">ğŸ”„ è¿ç§»æ–‡ä»¶</button>
                    <button class="tab" onclick="showTab('seeders')">ğŸŒ± ç§å­æ–‡ä»¶</button>
                    <button class="tab" onclick="showTab('commands')">âš¡ CLI å‘½ä»¤</button>
                </div>
                
                <div id="models" class="tab-content active">
                    <div class="output-container">
                        <button class="copy-btn" onclick="copyToClipboard('modelsOutput')">ğŸ“‹ å¤åˆ¶</button>
                        <div id="modelsOutput" class="output-area">è¯·å…ˆè¾“å…¥ DDL å¹¶ç‚¹å‡»è½¬æ¢...</div>
                    </div>
                </div>
                
                <div id="migration" class="tab-content">
                    <div class="output-container">
                        <button class="copy-btn" onclick="copyToClipboard('migrationOutput')">ğŸ“‹ å¤åˆ¶</button>
                        <div id="migrationOutput" class="output-area">è¯·å…ˆè¾“å…¥ DDL å¹¶ç‚¹å‡»è½¬æ¢...</div>
                    </div>
                </div>
                
                <div id="seeders" class="tab-content">
                    <div class="output-container">
                        <button class="copy-btn" onclick="copyToClipboard('seedersOutput')">ğŸ“‹ å¤åˆ¶</button>
                        <div id="seedersOutput" class="output-area">è¯·å…ˆè¾“å…¥ DDL å¹¶ç‚¹å‡»è½¬æ¢...</div>
                    </div>
                </div>
                
                <div id="commands" class="tab-content">
                    <div class="output-container">
                        <button class="copy-btn" onclick="copyToClipboard('commandsOutput')">ğŸ“‹ å¤åˆ¶</button>
                        <div id="commandsOutput" class="output-area">è¯·å…ˆè¾“å…¥ DDL å¹¶ç‚¹å‡»è½¬æ¢...</div>
                    </div>
                </div>
            </div>
            
            <div class="warning">
                <strong>âš ï¸ æ³¨æ„ï¼š</strong>ç”Ÿæˆçš„ä»£ç å¯èƒ½éœ€è¦æ ¹æ®æ‚¨çš„å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚è¯·æ£€æŸ¥æ•°æ®ç±»å‹æ˜ å°„ã€å…³ç³»å®šä¹‰å’Œçº¦æŸæ¡ä»¶æ˜¯å¦ç¬¦åˆæ‚¨çš„é¢„æœŸã€‚
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // éšè—æ‰€æœ‰é€‰é¡¹å¡å†…å®¹
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // ç§»é™¤æ‰€æœ‰é€‰é¡¹å¡çš„activeç±»
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // æ˜¾ç¤ºé€‰ä¸­çš„é€‰é¡¹å¡å†…å®¹
            document.getElementById(tabName).classList.add('active');
            
            // æ·»åŠ é€‰ä¸­é€‰é¡¹å¡çš„activeç±»
            event.target.classList.add('active');
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'âœ… å·²å¤åˆ¶';
                btn.style.background = '#28a745';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#667eea';
                }, 2000);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }

        function clearAll() {
            document.getElementById('ddlInput').value = '';
            document.getElementById('modelsOutput').textContent = 'è¯·å…ˆè¾“å…¥ DDL å¹¶ç‚¹å‡»è½¬æ¢...';
            document.getElementById('migrationOutput').textContent = 'è¯·å…ˆè¾“å…¥ DDL å¹¶ç‚¹å‡»è½¬æ¢...';
            document.getElementById('seedersOutput').textContent = 'è¯·å…ˆè¾“å…¥ DDL å¹¶ç‚¹å‡»è½¬æ¢...';
            document.getElementById('commandsOutput').textContent = 'è¯·å…ˆè¾“å…¥ DDL å¹¶ç‚¹å‡»è½¬æ¢...';
        }

        function convertDDL() {
            const ddlInput = document.getElementById('ddlInput').value.trim();
            
            if (!ddlInput) {
                alert('è¯·è¾“å…¥ DDL è¯­å¥');
                return;
            }

            try {
                console.log('å¼€å§‹è§£æ DDL:', ddlInput);
                const tables = parseDDL(ddlInput);
                
                console.log('è§£æç»“æœ:', tables);
                
                if (tables.length === 0) {
                    alert('æœªæ‰¾åˆ°æœ‰æ•ˆçš„è¡¨å®šä¹‰ã€‚è¯·æ£€æŸ¥æ‚¨çš„ DDL è¯­æ³•æ˜¯å¦æ­£ç¡®ã€‚\n\nç¡®ä¿ï¼š\n1. åŒ…å« CREATE TABLE è¯­å¥\n2. è¡¨åå’Œåˆ—åæ­£ç¡®\n3. æ¯ä¸ªè¯­å¥ä»¥åˆ†å·ç»“å°¾\n4. è¯­æ³•ç¬¦åˆ MySQL æ ‡å‡†');
                    
                    // åœ¨æ§åˆ¶å°æ˜¾ç¤ºæ›´å¤šè°ƒè¯•ä¿¡æ¯
                    console.log('DDL è§£æå¤±è´¥ï¼ŒåŸå§‹è¾“å…¥ï¼š', ddlInput);
                    
                    // å°è¯•ç®€å•çš„è¡¨ååŒ¹é…
                    const simpleTableMatch = ddlInput.match(/CREATE\s+TABLE\s+(\w+)/gi);
                    if (simpleTableMatch) {
                        console.log('æ‰¾åˆ°çš„è¡¨å:', simpleTableMatch);
                        alert('æ£€æµ‹åˆ°è¡¨å®šä¹‰ï¼Œä½†è§£æå¤±è´¥ã€‚è¯·æ£€æŸ¥è¯­æ³•æ ¼å¼ã€‚\næ‰¾åˆ°çš„è¡¨: ' + simpleTableMatch.join(', '));
                    } else {
                        alert('æœªæ£€æµ‹åˆ° CREATE TABLE è¯­å¥ã€‚è¯·ç¡®ä¿è¾“å…¥æ­£ç¡®çš„ DDL è¯­å¥ã€‚');
                    }
                    return;
                }

                const models = generateModels(tables);
                const migration = generateMigration(tables);
                const seeders = generateSeeders(tables);
                const commands = generateCommands(tables);

                document.getElementById('modelsOutput').textContent = models;
                document.getElementById('migrationOutput').textContent = migration;
                document.getElementById('seedersOutput').textContent = seeders;
                document.getElementById('commandsOutput').textContent = commands;

                console.log('è½¬æ¢å®Œæˆï¼Œç”Ÿæˆäº†', tables.length, 'ä¸ªè¡¨çš„ä»£ç ');

            } catch (error) {
                alert('è§£æ DDL æ—¶å‡ºé”™: ' + error.message + '\n\nè¯·æ£€æŸ¥ DDL è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œæˆ–åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚');
                console.error('DDL è§£æé”™è¯¯:', error);
                console.error('é”™è¯¯å †æ ˆ:', error.stack);
            }
        }

        function parseDDL(ddl) {
            const tables = [];
            // æ”¹è¿›çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ”¯æŒæ›´å¤šæ ¼å¼
            const tableRegex = /CREATE\s+TABLE\s+(?:IF\s+NOT\s+EXISTS\s+)?`?(\w+)`?\s*\(([\s\S]*?)\)(?:\s*ENGINE\s*=\s*\w+)?(?:\s*DEFAULT\s+CHARSET\s*=\s*[\w\-]+)?(?:\s*COLLATE\s*=\s*[\w\-]+)?(?:\s*AUTO_INCREMENT\s*=\s*\d+)?(?:\s*COMMENT\s*=\s*'[^']*')?;?/gi;
            let match;

            // æ¸…ç†DDLè¾“å…¥ï¼Œç§»é™¤æ³¨é‡Š
            ddl = ddl.replace(/--.*$/gm, '').replace(/\/\*[\s\S]*?\*\//g, '');

            while ((match = tableRegex.exec(ddl)) !== null) {
                const tableName = match[1];
                const columns = [];
                const foreignKeys = [];
                const indexes = [];
                
                const columnDefinitions = match[2];
                console.log(`è§£æè¡¨: ${tableName}`);
                console.log(`åˆ—å®šä¹‰: ${columnDefinitions}`);
                
                // æ”¹è¿›çš„åˆ†å‰²é€»è¾‘ï¼Œå¤„ç†æ‹¬å·å†…çš„é€—å·
                const lines = splitByComma(columnDefinitions);

                for (const line of lines) {
                    const trimmedLine = line.trim();
                    if (!trimmedLine) continue;
                    
                    console.log(`å¤„ç†è¡Œ: ${trimmedLine}`);
                    
                    if (trimmedLine.toLowerCase().includes('foreign key')) {
                        const fkMatch = trimmedLine.match(/FOREIGN\s+KEY\s*\(`?(\w+)`?\)\s+REFERENCES\s+`?(\w+)`?\s*\(`?(\w+)`?\)(?:\s+ON\s+DELETE\s+(CASCADE|RESTRICT|SET\s+NULL|NO\s+ACTION))?(?:\s+ON\s+UPDATE\s+(CASCADE|RESTRICT|SET\s+NULL|NO\s+ACTION))?/i);
                        if (fkMatch) {
                            foreignKeys.push({
                                column: fkMatch[1],
                                references: fkMatch[2],
                                referencesColumn: fkMatch[3],
                                onDelete: fkMatch[4] || 'RESTRICT',
                                onUpdate: fkMatch[5] || 'RESTRICT'
                            });
                        }
                    } else if (trimmedLine.toLowerCase().match(/^(primary\s+key|key|index|unique\s+key|unique\s+index)/)) {
                        // è·³è¿‡ç´¢å¼•å®šä¹‰
                        continue;
                    } else if (trimmedLine.toLowerCase().includes('constraint')) {
                        // è·³è¿‡çº¦æŸå®šä¹‰
                        continue;
                    } else {
                        const column = parseColumn(trimmedLine);
                        if (column) {
                            columns.push(column);
                            console.log(`æˆåŠŸè§£æåˆ—: ${column.name}`);
                        }
                    }
                }

                if (columns.length > 0) {
                    tables.push({
                        name: tableName,
                        columns: columns,
                        foreignKeys: foreignKeys
                    });
                    console.log(`æˆåŠŸæ·»åŠ è¡¨: ${tableName}, åˆ—æ•°: ${columns.length}`);
                }
            }

            console.log(`æ€»å…±è§£æåˆ° ${tables.length} ä¸ªè¡¨`);
            return tables;
        }

        // æ™ºèƒ½åˆ†å‰²å‡½æ•°ï¼Œå¤„ç†æ‹¬å·å†…çš„é€—å·
        function splitByComma(str) {
            const result = [];
            let current = '';
            let parenCount = 0;
            let inQuotes = false;
            let quoteChar = '';

            for (let i = 0; i < str.length; i++) {
                const char = str[i];
                
                if (!inQuotes && (char === "'" || char === '"')) {
                    inQuotes = true;
                    quoteChar = char;
                } else if (inQuotes && char === quoteChar) {
                    inQuotes = false;
                    quoteChar = '';
                }
                
                if (!inQuotes) {
                    if (char === '(') {
                        parenCount++;
                    } else if (char === ')') {
                        parenCount--;
                    }
                }
                
                if (char === ',' && parenCount === 0 && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            if (current.trim()) {
                result.push(current.trim());
            }
            
            return result;
        }

        function parseColumn(columnDef) {
            if (!columnDef || !columnDef.trim()) return null;
            
            // ç§»é™¤åå¼•å·
            columnDef = columnDef.replace(/`/g, '');
            
            const parts = columnDef.trim().split(/\s+/);
            if (parts.length < 2) return null;

            const name = parts[0];
            const dataType = parts[1];
            
            console.log(`è§£æåˆ—: ${name}, ç±»å‹: ${dataType}`);
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆçš„åˆ—åï¼ˆæ’é™¤å…³é”®å­—ï¼‰
            const keywords = ['primary', 'key', 'foreign', 'constraint', 'index', 'unique', 'check'];
            if (keywords.some(keyword => name.toLowerCase().includes(keyword))) {
                console.log(`è·³è¿‡å…³é”®å­—: ${name}`);
                return null;
            }
            
            const column = {
                name: name,
                type: mapDataType(dataType),
                allowNull: !columnDef.toLowerCase().includes('not null'),
                primaryKey: columnDef.toLowerCase().includes('primary key'),
                autoIncrement: columnDef.toLowerCase().includes('auto_increment'),
                unique: columnDef.toLowerCase().includes('unique') && !columnDef.toLowerCase().includes('primary key'),
                defaultValue: extractDefaultValue(columnDef)
            };

            return column;
        }

        function mapDataType(mysqlType) {
            const type = mysqlType.toLowerCase();
            
            if (type.includes('int')) {
                return 'INTEGER';
            } else if (type.includes('varchar') || type.includes('char')) {
                const match = type.match(/\((\d+)\)/);
                return match ? `STRING(${match[1]})` : 'STRING';
            } else if (type.includes('text')) {
                return 'TEXT';
            } else if (type.includes('decimal') || type.includes('numeric')) {
                const match = type.match(/\((\d+),(\d+)\)/);
                return match ? `DECIMAL(${match[1]}, ${match[2]})` : 'DECIMAL';
            } else if (type.includes('float')) {
                return 'FLOAT';
            } else if (type.includes('double')) {
                return 'DOUBLE';
            } else if (type.includes('boolean') || type.includes('bool')) {
                return 'BOOLEAN';
            } else if (type.includes('date')) {
                return 'DATE';
            } else if (type.includes('timestamp')) {
                return 'DATE';
            } else if (type.includes('datetime')) {
                return 'DATE';
            } else if (type.includes('enum')) {
                const match = type.match(/enum\s*\((.*?)\)/i);
                if (match) {
                    const values = match[1].split(',').map(v => v.trim().replace(/['"]/g, ''));
                    return `ENUM(${values.map(v => `'${v}'`).join(', ')})`;
                }
                return 'STRING';
            } else if (type.includes('json')) {
                return 'JSON';
            }
            
            return 'STRING';
        }

        function extractDefaultValue(columnDef) {
            // åŒ¹é… DEFAULT åé¢çš„å€¼ï¼Œè€ƒè™‘å„ç§æƒ…å†µ
            const defaultMatch = columnDef.match(/DEFAULT\s+((?:'[^']*'|"[^"]*"|\w+|\([^)]*\)|CURRENT_TIMESTAMP|NOW\(\)|NULL))/i);
            if (defaultMatch) {
                let value = defaultMatch[1].trim();
                
                if (value.toLowerCase() === 'current_timestamp' || value.toLowerCase() === 'now()') {
                    return 'DataTypes.NOW';
                } else if (value.toLowerCase() === 'null') {
                    return null;
                } else if (value.match(/^['"].*['"]$/)) {
                    return value;
                } else if (!isNaN(value) && value !== '') {
                    return value;
                } else if (value.startsWith('(') && value.endsWith(')')) {
                    return value; // å‡½æ•°è°ƒç”¨
                }
                return `'${value}'`;
            }
            return null;
        }

        function generateModels(tables) {
            let output = '';
            
            for (const table of tables) {
                const modelName = toPascalCase(table.name);
                
                output += `// models/${table.name}.js\n`;
                output += `const { DataTypes } = require('sequelize');\n`;
                output += `const sequelize = require('../config/database');\n\n`;
                
                output += `const ${modelName} = sequelize.define('${modelName}', {\n`;
                
                for (const column of table.columns) {
                    output += `  ${column.name}: {\n`;
                    output += `    type: DataTypes.${column.type},\n`;
                    
                    if (column.primaryKey) {
                        output += `    primaryKey: true,\n`;
                    }
                    
                    if (column.autoIncrement) {
                        output += `    autoIncrement: true,\n`;
                    }
                    
                    if (!column.allowNull) {
                        output += `    allowNull: false,\n`;
                    }
                    
                    if (column.unique) {
                        output += `    unique: true,\n`;
                    }
                    
                    if (column.defaultValue !== null) {
                        output += `    defaultValue: ${column.defaultValue},\n`;
                    }
                    
                    output += `  },\n`;
                }
                
                output += `}, {\n`;
                output += `  tableName: '${table.name}',\n`;
                output += `  timestamps: true,\n`;
                output += `  createdAt: 'created_at',\n`;
                output += `  updatedAt: 'updated_at'\n`;
                output += `});\n\n`;
                
                // æ·»åŠ å…³è”
                if (table.foreignKeys.length > 0) {
                    output += `// å…³è”å®šä¹‰\n`;
                    for (const fk of table.foreignKeys) {
                        const refModelName = toPascalCase(fk.references);
                        output += `${modelName}.belongsTo(${refModelName}, {\n`;
                        output += `  foreignKey: '${fk.column}',\n`;
                        output += `  onDelete: '${fk.onDelete}',\n`;
                        output += `  onUpdate: '${fk.onUpdate}'\n`;
                        output += `});\n`;
                    }
                    output += `\n`;
                }
                
                output += `module.exports = ${modelName};\n\n`;
                output += `${'='.repeat(60)}\n\n`;
            }
            
            return output;
        }

        function generateMigration(tables) {
            const timestamp = new Date().toISOString().replace(/[-:T]/g, '').substr(0, 14);
            let output = '';
            
            output += `// migrations/${timestamp}-create-tables.js\n`;
            output += `'use strict';\n\n`;
            output += `module.exports = {\n`;
            output += `  async up(queryInterface, Sequelize) {\n`;
            
            for (const table of tables) {
                output += `    await queryInterface.createTable('${table.name}', {\n`;
                
                for (const column of table.columns) {
                    output += `      ${column.name}: {\n`;
                    output += `        type: Sequelize.${column.type},\n`;
                    
                    if (column.primaryKey) {
                        output += `        primaryKey: true,\n`;
                    }
                    
                    if (column.autoIncrement) {
                        output += `        autoIncrement: true,\n`;
                    }
                    
                    if (!column.allowNull) {
                        output += `        allowNull: false,\n`;
                    }
                    
                    if (column.unique) {
                        output += `        unique: true,\n`;
                    }
                    
                    if (column.defaultValue !== null) {
                        output += `        defaultValue: ${column.defaultValue},\n`;
                    }
                    
                    output += `      },\n`;
                }
                
                // æ·»åŠ æ—¶é—´æˆ³å­—æ®µ
                output += `      created_at: {\n`;
                output += `        type: Sequelize.DATE,\n`;
                output += `        allowNull: false,\n`;
                output += `        defaultValue: Sequelize.NOW\n`;
                output += `      },\n`;
                output += `      updated_at: {\n`;
                output += `        type: Sequelize.DATE,\n`;
                output += `        allowNull: false,\n`;
                output += `        defaultValue: Sequelize.NOW\n`;
                output += `      }\n`;
                
                output += `    });\n\n`;
            }
            
            // æ·»åŠ å¤–é”®çº¦æŸ
            for (const table of tables) {
                for (const fk of table.foreignKeys) {
                    output += `    await queryInterface.addConstraint('${table.name}', {\n`;
                    output += `      fields: ['${fk.column}'],\n`;
                    output += `      type: 'foreign key',\n`;
                    output += `      name: 'fk_${table.name}_${fk.column}',\n`;
                    output += `      references: {\n`;
                    output += `        table: '${fk.references}',\n`;
                    output += `        field: '${fk.referencesColumn}'\n`;
                    output += `      },\n`;
                    output += `      onDelete: '${fk.onDelete}',\n`;
                    output += `      onUpdate: '${fk.onUpdate}'\n`;
                    output += `    });\n\n`;
                }
            }
            
            output += `  },\n\n`;
            output += `  async down(queryInterface, Sequelize) {\n`;
            
            // åˆ é™¤å¤–é”®çº¦æŸ
            for (const table of tables) {
                for (const fk of table.foreignKeys) {
                    output += `    await queryInterface.removeConstraint('${table.name}', 'fk_${table.name}_${fk.column}');\n`;
                }
            }
            
            // åˆ é™¤è¡¨
            for (let i = tables.length - 1; i >= 0; i--) {
                output += `    await queryInterface.dropTable('${tables[i].name}');\n`;
            }
            
            output += `  }\n`;
            output += `};\n`;
            
            return output;
        }

        function generateSeeders(tables) {
            const timestamp = new Date().toISOString().replace(/[-:T]/g, '').substr(0, 14);
            let output = '';
            
            for (const table of tables) {
                output += `// seeders/${timestamp}-${table.name}.js\n`;
                output += `'use strict';\n\n`;
                output += `module.exports = {\n`;
                output += `  async up(queryInterface, Sequelize) {\n`;
                output += `    await queryInterface.bulkInsert('${table.name}', [\n`;
                
                // ç”Ÿæˆç¤ºä¾‹æ•°æ®
                output += `      {\n`;
                for (const column of table.columns) {
                    if (!column.autoIncrement && !column.name.includes('_at')) {
                        const sampleValue = generateSampleValue(column);
                        output += `        ${column.name}: ${sampleValue},\n`;
                    }
                }
                output += `        created_at: new Date(),\n`;
                output += `        updated_at: new Date()\n`;
                output += `      },\n`;
                
                output += `      // æ·»åŠ æ›´å¤šç¤ºä¾‹æ•°æ®...\n`;
                output += `    ], {});\n`;
                output += `  },\n\n`;
                output += `  async down(queryInterface, Sequelize) {\n`;
                output += `    await queryInterface.bulkDelete('${table.name}', null, {});\n`;
                output += `  }\n`;
                output += `};\n\n`;
                output += `${'='.repeat(60)}\n\n`;
            }
            
            return output;
        }

        function generateSampleValue(column) {
            if (column.type.includes('STRING')) {
                if (column.name.includes('email')) {
                    return "'example@email.com'";
                } else if (column.name.includes('name')) {
                    return "'ç¤ºä¾‹åç§°'";
                } else if (column.name.includes('password')) {
                    return "'hashed_password'";
                }
                return "'ç¤ºä¾‹æ–‡æœ¬'";
            } else if (column.type.includes('INTEGER')) {
                return '1';
            } else if (column.type.includes('BOOLEAN')) {
                return 'true';
            } else if (column.type.includes('DATE')) {
                return 'new Date()';
            } else if (column.type.includes('ENUM')) {
                const match = column.type.match(/ENUM\((.*?)\)/);
                if (match) {
                    const firstValue = match[1].split(',')[0].trim();
                    return firstValue;
                }
                return "'enum_value'";
            }
            return "'é»˜è®¤å€¼'";
        }

        function generateCommands(tables) {
            let output = '';
            
            output += `# Sequelize CLI å‘½ä»¤\n\n`;
            output += `## 1. åˆå§‹åŒ– Sequelize é¡¹ç›®\n`;
            output += `npx sequelize-cli init\n\n`;
            
            output += `## 2. é…ç½®æ•°æ®åº“è¿æ¥\n`;
            output += `# ç¼–è¾‘ config/config.json æ–‡ä»¶\n\n`;
            
            output += `## 3. åˆ›å»ºæ•°æ®åº“\n`;
            output += `npx sequelize-cli db:create\n\n`;
            
            output += `## 4. è¿è¡Œè¿ç§»\n`;
            output += `npx sequelize-cli db:migrate\n\n`;
            
            output += `## 5. è¿è¡Œç§å­æ•°æ®\n`;
            output += `npx sequelize-cli db:seed:all\n\n`;
            
            output += `## 6. æ’¤é”€è¿ç§»ï¼ˆå¦‚æœéœ€è¦ï¼‰\n`;
            output += `npx sequelize-cli db:migrate:undo:all\n\n`;
            
            output += `## 7. ç”Ÿæˆæ–°çš„è¿ç§»æ–‡ä»¶ï¼ˆå•ä¸ªè¡¨ï¼‰\n`;
            for (const table of tables) {
                output += `npx sequelize-cli migration:generate --name create-${table.name}\n`;
            }
            output += `\n`;
            
            output += `## 8. ç”Ÿæˆç§å­æ–‡ä»¶ï¼ˆå•ä¸ªè¡¨ï¼‰\n`;
            for (const table of tables) {
                output += `npx sequelize-cli seed:generate --name ${table.name}-seeder\n`;
            }
            output += `\n`;
            
            output += `## 9. å®‰è£…ä¾èµ–\n`;
            output += `npm install sequelize mysql2\n`;
            output += `npm install --save-dev sequelize-cli\n\n`;
            
            output += `## 10. ç¯å¢ƒå˜é‡ç¤ºä¾‹ (.env)\n`;
            output += `DB_HOST=localhost\n`;
            output += `DB_PORT=3306\n`;
            output += `DB_NAME=your_database\n`;
            output += `DB_USERNAME=your_username\n`;
            output += `DB_PASSWORD=your_password\n\n`;
            
            output += `## 11. æ•°æ®åº“é…ç½®ç¤ºä¾‹ (config/config.json)\n`;
            output += `{\n`;
            output += `  "development": {\n`;
            output += `    "username": "root",\n`;
            output += `    "password": "password",\n`;
            output += `    "database": "your_database",\n`;
            output += `    "host": "127.0.0.1",\n`;
            output += `    "dialect": "mysql"\n`;
            output += `  }\n`;
            output += `}\n\n`;
            
            output += `## 12. æ¨¡å‹ä½¿ç”¨ç¤ºä¾‹\n`;
            for (const table of tables) {
                const modelName = toPascalCase(table.name);
                output += `const ${modelName} = require('./models/${table.name}');\n`;
            }
            output += `\n`;
            output += `// åˆ›å»ºè®°å½•\n`;
            if (tables.length > 0) {
                const firstTable = tables[0];
                const modelName = toPascalCase(firstTable.name);
                output += `const new${modelName} = await ${modelName}.create({ /* æ•°æ® */ });\n\n`;
                
                output += `// æŸ¥è¯¢è®°å½•\n`;
                output += `const all${modelName}s = await ${modelName}.findAll();\n`;
                output += `const one${modelName} = await ${modelName}.findByPk(1);\n\n`;
                
                output += `// æ›´æ–°è®°å½•\n`;
                output += `await ${modelName}.update({ /* æ–°æ•°æ® */ }, { where: { id: 1 } });\n\n`;
                
                output += `// åˆ é™¤è®°å½•\n`;
                output += `await ${modelName}.destroy({ where: { id: 1 } });\n`;
            }
            
            return output;
        }

        function toPascalCase(str) {
            return str.replace(/_([a-z])/g, (g) => g[1].toUpperCase())
                     .replace(/^[a-z]/, (g) => g.toUpperCase());
        }
    </script>
</body>
</html>
