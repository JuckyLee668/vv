<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V2Ray é…ç½®è½¬æ¢å™¨ | Base64 ç¼–ç å·¥å…·</title>
    <link rel="shortcut icon" href="../assets/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            width: 90%;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            border-left: 4px solid #667eea;
            padding-left: 20px;
        }

        h1 {
            color: #553c9a;
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 15px;
            display: block;
        }

        .subtitle {
            color: #6c757d;
            font-size: 1.1rem;
            font-weight: 300;
        }

        .nav-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .nav-button {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            text-decoration: none;
            border-radius: 25px;
            margin: 0 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .warning-notice {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }

        .warning-notice i {
            font-size: 1.2rem;
        }

        .input-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid #e8ecf0;
            border-left: 4px solid #667eea;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #553c9a;
            font-size: 1rem;
        }

        .input-group textarea,
        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e8ecf0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }

        .input-group textarea:focus,
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group textarea {
            min-height: 150px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #6c757d;
            border: 2px solid #e8ecf0;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .result-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid #e8ecf0;
            border-left: 4px solid #28a745;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .result-header h3 {
            color: #553c9a;
            font-size: 1.3rem;
        }

        .copy-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            transform: scale(1.05);
        }

        .result-text {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
            border: 2px solid #e8ecf0;
            min-height: 120px;
            color: #495057;
        }

        .github-section {
            background: linear-gradient(135deg, #24292e, #2f363d);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .github-section h3 {
            color: white;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .config-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .config-card label {
            color: #f6f8fa;
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .config-card input {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-family: 'Courier New', monospace;
        }

        .config-card input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            margin-top: 10px;
        }

        .status-ready {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .status-warning {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .help-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            border-left: 4px solid #17a2b8;
        }

        .help-section h3 {
            color: #553c9a;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .help-section ul {
            list-style: none;
            padding-left: 0;
        }

        .help-section li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            color: #6c757d;
        }

        .help-section li:last-child {
            border-bottom: none;
        }

        .help-section li::before {
            content: "â–¶";
            color: #667eea;
            margin-right: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #e8ecf0;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .accordion {
            margin-top: 20px;
        }

        .accordion-item {
            background: white;
            border: 1px solid #e8ecf0;
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .accordion-header {
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .accordion-header:hover {
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
        }

        .accordion-header h4 {
            color: #553c9a;
            margin: 0;
        }

        .accordion-content {
            padding: 20px;
            display: none;
            border-top: 1px solid #e8ecf0;
        }

        .accordion-content.active {
            display: block;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            .button-group {
                flex-direction: column;
                align-items: stretch;
            }

            .btn {
                margin-bottom: 10px;
            }

            .config-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="header">
            <i class="fas fa-exchange-alt header-icon"></i>
            <h1>V2Ray é…ç½®è½¬æ¢å™¨</h1>
            <p class="subtitle">å°† VLESS/Trojan ç­‰åè®®è½¬æ¢ä¸º Base64 ç¼–ç ï¼Œå¹¶è‡ªåŠ¨æ›´æ–° GitHub ä»“åº“</p>
        </div>

        <!-- å¯¼èˆªåŒºåŸŸ -->
        <div class="nav-section">
            <a href="../index.html" class="nav-button">
                <i class="fas fa-home"></i> è¿”å›é¦–é¡µ
            </a>
            <a href="../tool/tools.html" class="nav-button">
                <i class="fas fa-tools"></i> å·¥å…·é›†åˆ
            </a>
        </div>

        <!-- å®‰å…¨è­¦å‘Š -->
        <div class="warning-notice">
            <i class="fas fa-shield-alt"></i>
            <div>
                <strong>å®‰å…¨æé†’ï¼š</strong>
                è¯·ç¡®ä¿æ‚¨çš„é…ç½®ä¿¡æ¯å®‰å…¨ï¼Œé¿å…åœ¨å…¬å…±ç½‘ç»œç¯å¢ƒä¸‹ä½¿ç”¨æ­¤å·¥å…·ã€‚è½¬æ¢åçš„å†…å®¹å°†é€šè¿‡ GitHub Action è‡ªåŠ¨éƒ¨ç½²ã€‚
            </div>
        </div>

        <!-- é…ç½®è¾“å…¥åŒºåŸŸ -->
        <div class="input-section">
            <div class="input-group">
                <label for="configInput">
                    <i class="fas fa-code"></i> è¾“å…¥ V2Ray é…ç½®é“¾æ¥
                </label>
                <textarea 
                    id="configInput" 
                    placeholder="è¯·è¾“å…¥ VLESSã€Trojanã€VMess ç­‰åè®®é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ªé…ç½®ï¼š&#10;&#10;vless://uuid@server:port?encryption=none&security=tls&type=ws&host=example.com&path=/path#name&#10;trojan://password@server:port?security=tls&type=grpc&serviceName=service#name&#10;vmess://base64-encoded-config"
                ></textarea>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="convertToBase64()">
                    <i class="fas fa-sync-alt"></i> è½¬æ¢ä¸º Base64
                </button>
                <button class="btn btn-secondary" onclick="clearInput()">
                    <i class="fas fa-trash"></i> æ¸…ç©ºè¾“å…¥
                </button>
                <button class="btn btn-secondary" onclick="loadSample()">
                    <i class="fas fa-file-import"></i> åŠ è½½ç¤ºä¾‹
                </button>
            </div>
        </div>

        <!-- è½¬æ¢ç»“æœåŒºåŸŸ -->
        <div class="result-section" id="resultSection" style="display: none;">
            <div class="result-header">
                <h3><i class="fas fa-check-circle"></i> è½¬æ¢ç»“æœ</h3>
                <button class="copy-btn" onclick="copyResult()">
                    <i class="fas fa-copy"></i> å¤åˆ¶ç»“æœ
                </button>
            </div>
            <div class="result-text" id="resultText"></div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="configCount">0</span>
                    <div class="stat-label">é…ç½®æ•°é‡</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="base64Length">0</span>
                    <div class="stat-label">ç¼–ç é•¿åº¦</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="protocolCount">0</span>
                    <div class="stat-label">åè®®ç±»å‹</div>
                </div>
            </div>
        </div>

        <!-- GitHub Action é…ç½® -->
        <div class="github-section">
            <h3>
                <i class="fab fa-github"></i> GitHub Action è‡ªåŠ¨éƒ¨ç½²é…ç½®
            </h3>
            <p style="color: #f6f8fa; margin-bottom: 20px;">
                é…ç½® GitHub Action ä»¥è‡ªåŠ¨æ›´æ–°ä»“åº“ä¸­çš„ v2 æ–‡ä»¶ã€‚è¯·ç¡®ä¿å·²åœ¨ä»“åº“è®¾ç½®ä¸­é…ç½®ç›¸åº”çš„ Secretsã€‚
            </p>

            <div class="config-grid">
                <div class="config-card">
                    <label for="githubRepo">GitHub ä»“åº“åœ°å€</label>
                    <input type="text" id="githubRepo" placeholder="username/repository" value="JuckyLee668/vv">
                </div>
                <div class="config-card">
                    <label for="githubToken">GitHub Token (å¯é€‰)</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx">
                </div>
                <div class="config-card">
                    <label for="targetFile">ç›®æ ‡æ–‡ä»¶è·¯å¾„</label>
                    <input type="text" id="targetFile" placeholder="v2" value="v2">
                </div>
                <div class="config-card">
                    <label for="commitMessage">æäº¤ä¿¡æ¯</label>
                    <input type="text" id="commitMessage" placeholder="Update v2 config" value="ğŸ”„ Auto update v2 config">
                </div>
            </div>

            <div class="button-group" style="margin-top: 20px;">
                <button class="btn btn-success" onclick="triggerGithubAction()">
                    <i class="fas fa-rocket"></i> è§¦å‘ GitHub Action
                </button>
                <button class="btn btn-success" onclick="directUpdateFile()">
                    <i class="fas fa-upload"></i> ç›´æ¥æ›´æ–°æ–‡ä»¶
                </button>
                <button class="btn btn-secondary" onclick="generateActionConfig()">
                    <i class="fas fa-cog"></i> ç”Ÿæˆ Action é…ç½®
                </button>
                <button class="btn btn-secondary" onclick="checkActionStatus()">
                    <i class="fas fa-search"></i> æ£€æŸ¥è¿è¡ŒçŠ¶æ€
                </button>
            </div>

            <div class="status-indicator status-ready" id="githubStatus">
                <i class="fas fa-check-circle"></i>
                GitHub é…ç½®å°±ç»ª
            </div>
        </div>

        <!-- å¸®åŠ©è¯´æ˜ -->
        <div class="help-section">
            <h3>
                <i class="fas fa-question-circle"></i> ä½¿ç”¨è¯´æ˜
            </h3>
            
            <div class="accordion">
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>æ”¯æŒçš„åè®®æ ¼å¼</h4>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="accordion-content">
                        <ul>
                            <li>VLESS: vless://uuid@server:port?encryption=none&security=tls&type=ws&host=example.com&path=/path#name</li>
                            <li>Trojan: trojan://password@server:port?security=tls&type=grpc&serviceName=service#name</li>
                            <li>VMess: vmess://base64-encoded-config</li>
                            <li>Shadowsocks: ss://method:password@server:port#name</li>
                        </ul>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>GitHub Action è®¾ç½®</h4>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="accordion-content">
                        <ul>
                            <li>åœ¨ä»“åº“ Settings > Secrets ä¸­æ·»åŠ  GITHUB_TOKEN</li>
                            <li>ç¡®ä¿ Actions æƒé™å…è®¸å†™å…¥ä»“åº“å†…å®¹</li>
                            <li>åˆ›å»º .github/workflows/update-v2.yml æ–‡ä»¶</li>
                            <li>é…ç½®æ­£ç¡®çš„åˆ†æ”¯å’Œæ–‡ä»¶è·¯å¾„</li>
                        </ul>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>å®‰å…¨æ³¨æ„äº‹é¡¹</h4>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="accordion-content">
                        <ul>
                            <li>ä¸è¦åœ¨å…¬å…±ç¯å¢ƒä¸­ä½¿ç”¨æ•æ„Ÿé…ç½®</li>
                            <li>å®šæœŸæ›´æ¢é…ç½®ä¿¡æ¯ä»¥ç¡®ä¿å®‰å…¨</li>
                            <li>ä½¿ç”¨ GitHub Secrets å­˜å‚¨æ•æ„Ÿä¿¡æ¯</li>
                            <li>ç›‘æ§ä»“åº“è®¿é—®æ—¥å¿—</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥ GitHub API å®¢æˆ·ç«¯ -->
    <script src="../api/github-client.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let githubClient = null;
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadGithubConfig();
            updateStatus();
            initializeGitHubClient();
        });

        // è½¬æ¢ä¸º Base64
        function convertToBase64() {
            const input = document.getElementById('configInput').value.trim();
            if (!input) {
                alert('è¯·è¾“å…¥é…ç½®ä¿¡æ¯ï¼');
                return;
            }

            try {
                // å°†è¾“å…¥å†…å®¹è½¬æ¢ä¸º Base64
                const base64Result = btoa(unescape(encodeURIComponent(input)));
                
                // æ˜¾ç¤ºç»“æœ
                document.getElementById('resultText').textContent = base64Result;
                document.getElementById('resultSection').style.display = 'block';
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateStats(input, base64Result);
                
                // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                document.getElementById('resultSection').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });

                console.log('è½¬æ¢å®Œæˆï¼ŒBase64 é•¿åº¦:', base64Result.length);
            } catch (error) {
                alert('è½¬æ¢è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼š' + error.message);
                console.error('è½¬æ¢é”™è¯¯:', error);
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(input, base64Result) {
            const lines = input.split('\n').filter(line => line.trim() !== '');
            const protocols = new Set();
            
            lines.forEach(line => {
                if (line.includes('vless://')) protocols.add('VLESS');
                if (line.includes('trojan://')) protocols.add('Trojan');
                if (line.includes('vmess://')) protocols.add('VMess');
                if (line.includes('ss://')) protocols.add('Shadowsocks');
            });

            document.getElementById('configCount').textContent = lines.length;
            document.getElementById('base64Length').textContent = base64Result.length;
            document.getElementById('protocolCount').textContent = protocols.size;
        }

        // å¤åˆ¶ç»“æœ
        function copyResult() {
            const resultText = document.getElementById('resultText').textContent;
            navigator.clipboard.writeText(resultText).then(function() {
                const copyBtn = document.querySelector('.copy-btn');
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                copyBtn.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
                
                setTimeout(function() {
                    copyBtn.innerHTML = originalText;
                    copyBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                }, 2000);
            }).catch(function(err) {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ç»“æœ');
                console.error('å¤åˆ¶é”™è¯¯:', err);
            });
        }

        // æ¸…ç©ºè¾“å…¥
        function clearInput() {
            document.getElementById('configInput').value = '';
            document.getElementById('resultSection').style.display = 'none';
        }

        // åŠ è½½ç¤ºä¾‹é…ç½®
        function loadSample() {
            const sampleConfig = `vless://9dfb0013-b928-4e0e-8590-63c19c6ff943@www.visa.com.sg:8880?encryption=none&security=none&type=ws&host=vless.xi-han.workers.dev&path=%2F%3Fed%3D2048#vless.xi-han.workers.dev
trojan://4ae018ff-b370-4b10-877f-cb7788f4464f@a.xi-han.top:443?security=tls&type=grpc&authority=&serviceName=4ae018ff-b370-4b10-877f-cb7788f4464f&mode=gun#vi_am
trojan://a21b192f-891b-4029-afe7-2d39f1132512@x.xi-han.top:443?security=tls&type=grpc&authority=&serviceName=a21b192f-891b-4029-afe7-2d39f1132512&mode=gun#hw_si`;
            
            document.getElementById('configInput').value = sampleConfig;
        }

        // åˆå§‹åŒ– GitHub å®¢æˆ·ç«¯
        function initializeGitHubClient() {
            const repo = document.getElementById('githubRepo').value;
            const token = document.getElementById('githubToken').value;
            
            if (repo && token) {
                githubClient = new GitHubAPIClient(token, repo);
                checkGitHubConnection();
            }
        }

        // æ£€æŸ¥ GitHub è¿æ¥
        async function checkGitHubConnection() {
            if (!githubClient) return;
            
            updateStatus('æ­£åœ¨æ£€æŸ¥ GitHub è¿æ¥...', 'warning');
            
            try {
                const result = await githubClient.checkPermissions();
                if (result.success) {
                    updateStatus('GitHub è¿æ¥æ­£å¸¸', 'success');
                    console.log('GitHub æƒé™:', result.permissions);
                } else {
                    updateStatus('GitHub è¿æ¥å¤±è´¥', 'error');
                    console.error('è¿æ¥é”™è¯¯:', result.error);
                }
            } catch (error) {
                updateStatus('GitHub è¿æ¥é”™è¯¯', 'error');
                console.error('è¿æ¥å¼‚å¸¸:', error);
            }
        }

        // è§¦å‘ GitHub Action (ä½¿ç”¨çœŸå® API)
        async function triggerGithubAction() {
            const resultText = document.getElementById('resultText').textContent;
            if (!resultText) {
                alert('è¯·å…ˆè½¬æ¢é…ç½®å†è§¦å‘ GitHub Actionï¼');
                return;
            }

            const repo = document.getElementById('githubRepo').value;
            const token = document.getElementById('githubToken').value;
            const commitMessage = document.getElementById('commitMessage').value;

            // éªŒè¯è¾“å…¥
            if (!repo) {
                alert('è¯·è¾“å…¥ GitHub ä»“åº“åœ°å€ï¼');
                return;
            }

            if (!isValidRepoName(repo)) {
                alert('ä»“åº“åœ°å€æ ¼å¼ä¸æ­£ç¡®ï¼\næ ¼å¼åº”ä¸º: username/repository');
                return;
            }

            if (!token) {
                // å¦‚æœæ²¡æœ‰ tokenï¼Œå¼•å¯¼ç”¨æˆ·ä½¿ç”¨ GitHub Web ç•Œé¢
                const confirmed = confirm(
                    'æœªé…ç½® GitHub Tokenï¼\n\n' +
                    'æ‚¨å¯ä»¥é€‰æ‹©ï¼š\n' +
                    '1. ç‚¹å‡»"ç¡®å®š"å‰å¾€ GitHub Actions é¡µé¢æ‰‹åŠ¨è§¦å‘\n' +
                    '2. ç‚¹å‡»"å–æ¶ˆ"ååœ¨ä¸‹æ–¹é…ç½® GitHub Token\n\n' +
                    'æ¨èä½¿ç”¨é€‰é¡¹ 1ï¼Œæ›´åŠ å®‰å…¨ã€‚'
                );
                
                if (confirmed) {
                    const actionUrl = `https://github.com/${repo}/actions/workflows/update-v2.yml`;
                    window.open(actionUrl, '_blank');
                    
                    // æ˜¾ç¤ºæ“ä½œè¯´æ˜
                    showActionInstructions(resultText);
                }
                return;
            }

            if (!isValidGitHubToken(token)) {
                alert('GitHub Token æ ¼å¼ä¸æ­£ç¡®ï¼\nè¯·æ£€æŸ¥ Token æ˜¯å¦æœ‰æ•ˆã€‚');
                return;
            }

            try {
                updateStatus('æ­£åœ¨è§¦å‘ GitHub Action...', 'warning');
                
                // åˆ›å»º GitHub å®¢æˆ·ç«¯
                const client = new GitHubAPIClient(token, repo);
                
                // è§¦å‘ workflow
                const result = await client.triggerWorkflow('update-v2.yml', {
                    config_data: resultText,
                    commit_message: commitMessage || 'ğŸ”„ Auto update v2 config'
                });
                
                if (result.success) {
                    updateStatus('GitHub Action è§¦å‘æˆåŠŸï¼', 'success');
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    const actionUrl = `https://github.com/${repo}/actions`;
                    const message = `âœ… GitHub Action å·²æˆåŠŸè§¦å‘ï¼\n\n` +
                                  `ğŸ”— æŸ¥çœ‹è¿è¡ŒçŠ¶æ€: ${actionUrl}\n` +
                                  `â±ï¸ è¯·ç­‰å¾… 1-2 åˆ†é’Ÿåæ£€æŸ¥ç»“æœ`;
                    
                    alert(message);
                    
                    // è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
                    setTimeout(() => checkActionStatus(), 3000);
                    
                } else {
                    updateStatus('GitHub Action è§¦å‘å¤±è´¥', 'error');
                    alert('è§¦å‘å¤±è´¥ï¼š' + formatGitHubError(result.error));
                }
            } catch (error) {
                updateStatus('è§¦å‘è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯', 'error');
                alert('è§¦å‘ GitHub Action æ—¶å‡ºç°é”™è¯¯ï¼š' + error.message);
                console.error('GitHub Action é”™è¯¯:', error);
            }
        }

        // æ˜¾ç¤ºæ‰‹åŠ¨æ“ä½œè¯´æ˜
        function showActionInstructions(configData) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white; border-radius: 15px; padding: 30px;
                    max-width: 600px; width: 100%; max-height: 80vh; overflow-y: auto;
                ">
                    <h3 style="color: #553c9a; margin-bottom: 20px;">
                        <i class="fas fa-info-circle"></i> GitHub Action æ‰‹åŠ¨æ“ä½œè¯´æ˜
                    </h3>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>æ­¥éª¤ 1:</strong> åœ¨æ–°æ‰“å¼€çš„é¡µé¢ä¸­ï¼Œç‚¹å‡» "Run workflow" æŒ‰é’®
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>æ­¥éª¤ 2:</strong> åœ¨ "config_data" å­—æ®µä¸­ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼š<br>
                        <textarea readonly style="
                            width: 100%; height: 120px; margin-top: 10px;
                            font-family: monospace; font-size: 12px;
                            border: 1px solid #ddd; border-radius: 4px; padding: 10px;
                        ">${configData}</textarea>
                        <button onclick="navigator.clipboard.writeText('${configData}')" style="
                            margin-top: 10px; padding: 8px 15px; background: #667eea;
                            color: white; border: none; border-radius: 5px; cursor: pointer;
                        ">å¤åˆ¶é…ç½®æ•°æ®</button>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>æ­¥éª¤ 3:</strong> ç‚¹å‡»ç»¿è‰²çš„ "Run workflow" æŒ‰é’®æ‰§è¡Œ
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                            padding: 10px 20px; background: #6c757d; color: white;
                            border: none; border-radius: 25px; cursor: pointer;
                        ">çŸ¥é“äº†</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // ç›´æ¥æ›´æ–°æ–‡ä»¶ (ä¸ä½¿ç”¨ Action)
        async function directUpdateFile() {
            const resultText = document.getElementById('resultText').textContent;
            if (!resultText) {
                alert('è¯·å…ˆè½¬æ¢é…ç½®ï¼');
                return;
            }

            const repo = document.getElementById('githubRepo').value;
            const token = document.getElementById('githubToken').value;
            const targetFile = document.getElementById('targetFile').value;
            const commitMessage = document.getElementById('commitMessage').value;

            if (!repo || !token) {
                alert('è¯·é…ç½® GitHub ä»“åº“å’Œ Tokenï¼');
                return;
            }

            try {
                updateStatus('æ­£åœ¨ç›´æ¥æ›´æ–°æ–‡ä»¶...', 'warning');
                
                const client = new GitHubAPIClient(token, repo);
                
                // è·å–å½“å‰æ–‡ä»¶å†…å®¹
                const fileResult = await client.getFileContent(targetFile);
                let sha = null;
                
                if (fileResult.success) {
                    sha = fileResult.sha;
                } else if (!fileResult.error.includes('Not Found')) {
                    throw new Error(fileResult.error);
                }
                
                // æ›´æ–°æ–‡ä»¶
                const updateResult = await client.updateFile(
                    targetFile,
                    resultText,
                    commitMessage || 'ğŸ”„ Update v2 config',
                    sha
                );
                
                if (updateResult.success) {
                    updateStatus('æ–‡ä»¶æ›´æ–°æˆåŠŸï¼', 'success');
                    alert(`âœ… æ–‡ä»¶æ›´æ–°æˆåŠŸï¼\n\nğŸ”— æŸ¥çœ‹æäº¤: ${updateResult.url}`);
                } else {
                    updateStatus('æ–‡ä»¶æ›´æ–°å¤±è´¥', 'error');
                    alert('æ›´æ–°å¤±è´¥ï¼š' + formatGitHubError(updateResult.error));
                }
                
            } catch (error) {
                updateStatus('æ›´æ–°è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯', 'error');
                alert('æ›´æ–°æ–‡ä»¶æ—¶å‡ºç°é”™è¯¯ï¼š' + error.message);
                console.error('æ–‡ä»¶æ›´æ–°é”™è¯¯:', error);
            }
        }

        // ç”Ÿæˆ Action é…ç½®æ–‡ä»¶
        function generateActionConfig() {
            const actionConfig = `name: Update V2Ray Config

on:
  workflow_dispatch:
    inputs:
      config_data:
        description: 'Base64 encoded config data'
        required: true
        type: string
      commit_message:
        description: 'Commit message'
        required: false
        default: 'ğŸ”„ Auto update v2 config'
        type: string

jobs:
  update-config:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Update v2 file
      run: |
        echo "\${{ github.event.inputs.config_data }}" > v2
        
    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add v2
        git commit -m "\${{ github.event.inputs.commit_message }}" || exit 0
        git push
      env:
        GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}`;

            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([actionConfig], { type: 'text/yaml' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'update-v2.yml';
            a.click();
            window.URL.revokeObjectURL(url);

            alert('GitHub Action é…ç½®æ–‡ä»¶å·²ä¸‹è½½ï¼\\nè¯·å°†æ–‡ä»¶æ”¾ç½®åœ¨ .github/workflows/ ç›®å½•ä¸‹ã€‚');
        }

        // æ£€æŸ¥ Action çŠ¶æ€
        function checkActionStatus() {
            const repo = document.getElementById('githubRepo').value;
            if (!repo) {
                alert('è¯·è¾“å…¥ GitHub ä»“åº“åœ°å€ï¼');
                return;
            }

            const actionUrl = `https://github.com/${repo}/actions`;
            window.open(actionUrl, '_blank');
        }

        // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
        function updateStatus(message = 'GitHub é…ç½®å°±ç»ª', type = 'ready') {
            const statusElement = document.getElementById('githubStatus');
            statusElement.className = `status-indicator status-${type}`;
            
            let icon = 'fas fa-check-circle';
            if (type === 'warning') icon = 'fas fa-clock';
            if (type === 'error') icon = 'fas fa-exclamation-triangle';
            if (type === 'success') icon = 'fas fa-check-circle';
            
            statusElement.innerHTML = `<i class="${icon}"></i> ${message}`;
        }

        // ä¿å­˜ GitHub é…ç½®
        function saveGithubConfig() {
            const config = {
                repo: document.getElementById('githubRepo').value,
                targetFile: document.getElementById('targetFile').value,
                commitMessage: document.getElementById('commitMessage').value
            };
            localStorage.setItem('githubConfig', JSON.stringify(config));
        }

        // åŠ è½½ GitHub é…ç½®
        function loadGithubConfig() {
            const saved = localStorage.getItem('githubConfig');
            if (saved) {
                const config = JSON.parse(saved);
                if (config.repo) document.getElementById('githubRepo').value = config.repo;
                if (config.targetFile) document.getElementById('targetFile').value = config.targetFile;
                if (config.commitMessage) document.getElementById('commitMessage').value = config.commitMessage;
            }
        }

        // ç›‘å¬é…ç½®å˜åŒ–å¹¶ä¿å­˜
        ['githubRepo', 'targetFile', 'commitMessage'].forEach(id => {
            document.getElementById(id).addEventListener('change', saveGithubConfig);
        });
        
        // ç›‘å¬ token å˜åŒ–å¹¶é‡æ–°åˆå§‹åŒ–å®¢æˆ·ç«¯
        document.getElementById('githubToken').addEventListener('change', function() {
            saveGithubConfig();
            initializeGitHubClient();
        });
        
        // ç›‘å¬ä»“åº“åœ°å€å˜åŒ–å¹¶é‡æ–°åˆå§‹åŒ–å®¢æˆ·ç«¯
        document.getElementById('githubRepo').addEventListener('change', function() {
            saveGithubConfig();
            initializeGitHubClient();
        });

        // æ‰‹é£ç´åŠŸèƒ½
        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('i');
            
            // åˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                icon.style.transform = 'rotate(0deg)';
            } else {
                // å…³é—­å…¶ä»–å±•å¼€çš„é¡¹ç›®
                document.querySelectorAll('.accordion-content.active').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelectorAll('.accordion-header i').forEach(item => {
                    item.style.transform = 'rotate(0deg)';
                });
                
                content.classList.add('active');
                icon.style.transform = 'rotate(180deg)';
            }
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            // Ctrl + Enter å¿«é€Ÿè½¬æ¢
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                convertToBase64();
            }
            
            // Ctrl + L æ¸…ç©ºè¾“å…¥
            if (e.ctrlKey && e.key === 'l') {
                e.preventDefault();
                clearInput();
            }
        });

        // è‡ªåŠ¨ä¿å­˜è¾“å…¥å†…å®¹
        let saveTimeout;
        document.getElementById('configInput').addEventListener('input', function() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                localStorage.setItem('configInput', this.value);
            }, 1000);
        });

        // æ¢å¤ä¿å­˜çš„è¾“å…¥å†…å®¹
        window.addEventListener('load', function() {
            const saved = localStorage.getItem('configInput');
            if (saved && !document.getElementById('configInput').value) {
                document.getElementById('configInput').value = saved;
            }
        });
    </script>
</body>
</html>
